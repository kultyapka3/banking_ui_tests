## Тесты

Этот репозиторий содержит проект автоматизированных UI и API-тестов, выполненный в рамках заданий SDET.

---

## Технологии

*   **Язык программирования:** Python 3.10+
*   **Фреймворк для UI-тестов:** Selenium WebDriver
*   **Фреймворк для API-тестов:** requests
*   **Сериализация/десериализация:** pydantic
*   **Браузер (UI):** Chrome (управление драйвером через `webdriver-manager`)
*   **Тестовый фреймворк:** pytest
*   **Сборка зависимостей:** pip (файл `requirements.txt`)
*   **Отчеты:** Allure (доп. задание №1)
*   **Параллельный запуск:** pytest-xdist (доп. задание №2)
*   **CI/CD:** GitHub Actions (доп. задание №3)

---

## Структура проекта

```
project_root/
├── README.md                         # Этот файл
├── .gitignore                        # Файл управления Git
├── requirements.txt                  # Список зависимостей Python
├── pytest.ini                        # Конфигурация pytest
├── conftest.py                       # Фикстуры pytest
├── screenshots/                      # Скриншоты для README
├── data/                             # Папка с данными (конфигурации)
│   ├── data_api.py                   # Данные для API тестов
│   └── data_ui.py                    # Данные для UI тестов
├── .github/workflows/                # Папка для CI/CD (GitHub Actions)
│   └── test.yml                      # Реализация CI/CD
├── ui/                               # Папка для UI-тестов
│   ├── __init__.py
│   ├── pages/                        # Папка для POM
│   │   ├── __init__.py
│   │   ├── base_page.py              # Общий Page Object
│   │   ├── manager_page.py           # Page Object страницы
│   │   └── manager_page_locators.py  # Локаторы элементов страницы
│   ├── tests/                        # Папка с UI тестами
│   │   ├── __init__.py            
│   │   ├── test_add_customer.py      # Тест для создания клиента (TC01)
│   │   ├── test_sort_customers.py    # Тест для сортировки клиентов (TC02)
│   │   └── test_delete_customer.py   # Тест для удаления клиента (TC03)
│   └── utils/                        # Папка для вспомогательных функций
│       ├── __init__.py
│       ├── data_generator.py         # Функции генерации данных (Post Code, First Name)
│       └── list_calculator.py        # Функции вычислений (средняя длина, ближайшее имя)
└── api/                              # Папка для API-тестов (2 задание)
    ├── __init__.py
    ├── models/                       # Папка для Pydantic моделей
    │   ├── __init__.py           
    │   └── entity.py                 # Модель данных сущности
    ├── services/                     # Папка для API-сервисов
    │   ├── __init__.py           
    │   └── entity_service.py         # Сервис для взаимодействия с API сущностей
    └── tests/                        # Папка с API тестами
        ├── __init__.py
        ├── test_create_entity.py     # Тест создания сущности
        ├── test_delete_entity.py     # Тест удаления сущности
        ├── test_get_all_entities.py  # Тест получения всех сущностей
        ├── test_get_entity.py        # Тест получения сущности
        └── test_update_entity.py     # Тест обновления сущности
```

---

## Установка и запуск

### Виртуальное окружение

1.  Создайте виртуальное окружение:
    ```bash
    python -m venv venv
    ```
    
2.  Активируйте его:
    *   **Windows:**
        ```bash
        venv\Scripts\activate
        ```
    *   **macOS/Linux:**
        ```bash
        source venv/bin/activate
        ```

### Установка зависимостей

После активации виртуального окружения установите зависимости из файла `requirements.txt`:
```bash
pip install -r requirements.txt
```

---

## Запуск приложения test-service (для API-тестов)

1. Клонируйте репозиторий `test-service`: 
    ```bash
    git clone https://github.com/bondarenkokate73/simbirsoft_sdet_project
    ```
   
2. Перейдите в папку `test-service`: 
    ```bash
    cd test-service
    ```
   
3. Убедитесь, что **Docker Desktop** запущен
4. Запустите приложение: 
    ```bash
    docker-compose up --build -d
    ```
   
5. Приложение будет доступно по адресу `http://localhost:8080`

---

## Запуск тестов

- Для запуска всех тестов используйте команду `pytest`:

    ```bash
    pytest
    ```

- Для более подробного вывода:

    ```bash
    pytest -v
    ```

- Пример запуска с параметрами (API тесты):

    ```bash
    pytest -m api
    ```

- Параллельный запуск UI тестов:

    ```bash
    pytest -m ui -n 3
    ```
  
- Параллельный запуск API тестов:

    ```bash
    pytest -m api -n 5
    ```

---

## Генерация отчета Allure

1. Запустите тесты, указав директорию для результатов Allure:

    ```bash
    pytest --alluredir=./allure_results
    ```
   
2. Сгенерируйте и откройте HTML-отчет:

    ```bash
    allure serve allure_results
    ```

---

## Тест-кейсы UI

### Тест-кейс №01. Создание клиента с генерацией данных (`Add Customer`)

- **Предусловие**:
  1. Открыть браузер
  2. Перейти по ссылке: https://www.globalsqa.com/angularJs-protractor/BankingProject/#/manager
  3. Перейти во вкладку `Add Customer`

- **Шаги**:
  1. Сгенерировать случайный 10-значный цифровой `Post Code` (например, `0001252667`)
  2. На основе сгенерированного `Post Code` сформировать `First Name` по следующей логике:
     - Разбить `Post Code` на пары цифр: `00`, `01`, `25`, `26`, `67`
     - Каждую пару интерпретировать как число. Если число > 25, использовать остаток от деления на 26 
     (например, `26 -> 0`, `67 -> 15`)
     - Преобразовать каждое число (0-25) в соответствующую букву алфавита (`0` -> 'a', `1` -> 'b', ..., `25` -> 'z')
     - Склеить полученные буквы. Пример: `00` (a), `01` (b), `25` (z), `26` (a), `67` (p) -> `abzap`)
  3. Ввести сгенерированное имя в поле `First Name`
  4. Ввести сгенерированный `Post Code` в поле `Post Code`.
  5. Ввести произвольное значение в поле `Last Name` (например, `Test`).
  6. Нажать кнопку `Add Customer`.

- **Ожидаемый результат**: 
  1. Появился **алерт** с текстом `Customer added successfully with customer id :*`
  2. Новый клиент с введёнными `First Name`, `Last Name` и `Post Code` отображается в таблице во вкладке `Customers`

- **Приоритет**: высокий

### Тест-кейс №02. Сортировка клиентов по имени (`First Name`)

- **Предусловие**:
  1. Открыть браузер
  2. Перейти по ссылке: https://www.globalsqa.com/angularJs-protractor/BankingProject/#/manager
  3. Перейти во владку `Customers`
  4. В таблице `Customers` присутствует более одного клиента

- **Шаги**:
  1. Запомнить текущий порядок имён в столбце `First Name`
  2. Нажать на заголовок столбца `First Name`
  3. Проверить, что список клиентов теперь отсортирован по `First Name` в обратном алфавитном порядке (Z-A)
  4. Нажать снова на заголовок столбца `First Name`
  5. Проверить, что список клиентов теперь отсортирован по `First Name` в алфавитном порядке (A-Z)

- **Ожидаемый результат**: 
  1. После первого клика по заголовку `First Name` имена сортируются в `обратном алфавитном порядке` (Z-A)
  2. После второго клика по заголовку `First Name` имена сортируются в `алфавитном порядке` (A-Z)

- **Приоритет**: средний

### Тест-кейс №03. Удаление клиента с именем, длина которого ближе всего к средней

- **Предусловие**:
  1. Открыть браузер
  2. Перейти по ссылке: https://www.globalsqa.com/angularJs-protractor/BankingProject/#/manager
  3. Перейти во владку `Customers`
  4. В таблице `Customers` присутствует более одного клиента

- **Шаги**:
  1. Получить список всех имён из столбца `First Name` в таблице `Customers`
  2. Вычислить длину каждого имени из списка
  3. Найти среднее арифметическое всех длин имён
  4. Определить имя, длина которого имеет минимальную разницу со средним арифметическим
  5. Найти строку в таблице, соответствующую этому имени
  6. Нажать кнопку `Delete` в этой строке

- **Ожидаемый результат**: клиент с именем, длина которого была ближе всего к средней, исчезает из таблицы `Customers`

- **Приоритет**: высокий

## Тест-кейсы API

### Тест-кейс №01. Создание сущности (`POST /api/create`)

- **Предусловие**:
  1. Запустить `test-service`

- **Шаги**:
  1. Отправить `POST` запрос на `/api/create` с корректными данными сущности (`EntityRequest`)
  2. Проверить, что возвращаемый `ID` - строка, содержащая число
  3. Отправить `GET` запрос на `/api/get/{id}` с полученным `ID`
  4. Проверить, что возвращаемая сущность (`EntityResponse`) содержит ожидаемые данные
  5. Удалить сущность

- **Ожидаемый результат**: сущность успешно создана, возвращен корректный `ID`, сущность доступна по `GET /api/get/{id}`

- **Приоритет**: высокий

### Тест-кейс №02. Получение сущности (`GET /api/get/{id}`)

- **Предусловие**:
  1. Запустить `test-service`

- **Шаги**:
  1. Создать сущность с помощью `POST /api/create` с корректными данными
  2. Отправить `GET` запрос на `/api/get/{id}` с полученным `ID`
  3. Проверить, что возвращаемая сущность (`EntityResponse`) содержит ожидаемые данные
  4. Удалить сущность

- **Ожидаемый результат**: существующая сущность успешно возвращена с корректными данными

- **Приоритет**: высокий

### Тест-кейс №03. Получение списка сущностей (`GET /api/getAll`)

- **Предусловие**:
  1. Запустить `test-service`

- **Шаги**:
  1. Создать несколько сущностей с помощью `POST /api/create`
  2. Отправить `GET` запрос на `/api/getAll`
  3. Проверить, что возвращаемый массив содержит все созданные сущности
  4. Удалить созданные сущности

- **Ожидаемый результат**: список всех сущностей успешно возвращен

- **Приоритет**: высокий

### Тест-кейс №04. Обновление сущности (`PATCH /api/patch/{id}`)

- **Предусловие**:
  1. Запустить `test-service`

- **Шаги**:
  1. Создать сущность с помощью `POST /api/create`
  2. Отправить `PATCH` запрос на `/api/patch/{id}` с новыми данными для созданной сущности
  3. Отправить `GET` запрос на `/api/get/{id}`
  4. Проверить, что возвращаемая сущность (`EntityResponse`) содержит обновлённые данные
  5. Удалить сущность

- **Ожидаемый результат**: сущность успешно обновлена, обновлённые данные доступны по `GET /api/get/{id}`

- **Приоритет**: высокий

### Тест-кейс №05. Удаление сущности (`DELETE /api/delete/{id}`)

- **Предусловие**:
  1. Запустить `test-service`

- **Шаги**:
  1. Создать сущность с помощью `POST /api/create`
  2. Отправить `GET` запрос на `/api/get/{id}`, чтобы убедиться, что сущность существует
  3. Отправить `DELETE` запрос на `/api/delete/{id}`
  4. Повторно отправить `GET` запрос на `/api/get/{id}` с тем же ID
  5. Проверить, что запрос завершается с ошибкой (500)

- **Ожидаемый результат**: сущность успешно удалена, повторный `GET` запрос вызывает ошибку с кодом 500

- **Приоритет**: высокий

---

## Allure отчет

![Allure Report Part 1](screenshots/allure_report1.jpg)

![Allure Report Part 2](screenshots/allure_report2.jpg)

![Allure Report Part 3](screenshots/allure_report3.jpg)
